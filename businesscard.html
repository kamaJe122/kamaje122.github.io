<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ™ºæ…§åç‰‡è¾¨è­˜ç³»çµ±</title>
    <style>
        :root {
            --ä¸»è‰²èª¿: #FFC400;
            --è¼”åŠ©è‰²: #FFD740;
            --æ‡¸æµ®è‰²: #FFAB00;
            --éŒ¯èª¤è‰²: #D32F2F;
            --åŸºç¤å­—é«”: 14px;
        }

        body {
            font-family: 'å¾®è»Ÿæ­£é»‘é«”', Arial, sans-serif;
            font-size: var(--åŸºç¤å­—é«”);
            background-color: #f8f9fa;
            margin: 0;
            padding: 20px;
        }

        .ä¸»å®¹å™¨ {
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background: white;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            border: 2px solid var(--ä¸»è‰²èª¿);
        }

        .æ‹–æ”¾å€ {
            border: 3px dashed var(--ä¸»è‰²èª¿);
            padding: 40px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            margin-bottom: 30px;
            background-color: rgba(255, 196, 0, 0.05);
        }

        .è¯çµ¡äººé …ç›® {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            padding: 15px;
            margin-bottom: 15px;
            border-radius: 8px;
            background-color: white;
            box-shadow: 0 2px 6px rgba(0,0,0,0.1);
            border-left: 4px solid var(--ä¸»è‰²èª¿);
            position: relative;
        }

        .è¯çµ¡äººå…§å®¹ {
            flex-grow: 1;
            margin-right: 20px;
        }

        .å§“åæ¬„ä½ {
            font-weight: 700;
            font-size: calc(var(--åŸºç¤å­—é«”) + 2pt);
            color: var(--ä¸»è‰²èª¿);
            margin-bottom: 8px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .è³‡æ–™æ¬„ä½ {
            margin: 6px 0;
            padding: 6px;
            border-radius: 4px;
            cursor: pointer;
            position: relative;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .åœ–ç¤ºå€ {
            min-width: 24px;
            text-align: center;
        }

        .ä¸»è¦æŒ‰éˆ• {
            background-color: var(--ä¸»è‰²èª¿);
            color: white;
            padding: 8px 20px;
            border-radius: 20px;
            min-width: 120px;
            border: none;
            cursor: pointer;
            transition: all 0.3s;
            align-self: center;
        }

        .ä¸»è¦æŒ‰éˆ•:hover {
            background-color: var(--æ‡¸æµ®è‰²);
            transform: translateY(-1px);
        }

        .ç·¨è¼¯è¼¸å…¥æ¡† {
            width: 100%;
            padding: 6px;
            font-size: inherit;
            font-family: inherit;
            border: 1px solid var(--ä¸»è‰²èª¿);
            border-radius: 4px;
        }

        .é€²åº¦æ¢å®¹å™¨ {
            width: 100%;
            height: 8px;
            background-color: #f0f0f0;
            border-radius: 4px;
            margin-top: 10px;
            overflow: hidden;
            display: none;
        }

        .é€²åº¦æ¢ {
            height: 100%;
            width: 0%;
            background-color: var(--ä¸»è‰²èª¿);
            transition: width 0.3s;
        }

        @media screen and (max-width: 430px) {
            .ä¸»å®¹å™¨ {
                padding: 15px;
                width: calc(100% - 20px);
                box-shadow: none;
                border-radius: 0;
                border: none;
            }

            .è¯çµ¡äººé …ç›® {
                flex-direction: column;
            }

            .ä¸»è¦æŒ‰éˆ• {
                width: 100%;
                margin-top: 10px;
            }
        }
    </style>
</head>
<body>
    <div class="ä¸»å®¹å™¨">
        <div class="æ‹–æ”¾å€" id="æ‹–æ”¾å€">
            <p>æ‹–æ”¾åç‰‡åœ–æª”è‡³æ­¤æˆ–é»æ“Šä¸Šå‚³ (æ”¯æ´ PNG/JPG)</p>
            <input type="file" id="æª”æ¡ˆè¼¸å…¥" hidden accept="image/png, image/jpeg">
            <div class="é€²åº¦æ¢å®¹å™¨" id="é€²åº¦æ¢å®¹å™¨">
                <div class="é€²åº¦æ¢" id="é€²åº¦æ¢"></div>
            </div>
        </div>

        <div id="è¯çµ¡äººæ¸…å–®"></div>

        <div class="å·¥å…·åˆ—">
            <button class="ä¸»è¦æŒ‰éˆ•" onclick="æ–°å¢è¯çµ¡äºº()">+ æ–°å¢è¯çµ¡äºº</button>
        </div>
    </div>

    <script>
        let è¯çµ¡äººåˆ—è¡¨ = [];

        // åˆå§‹åŒ–æ‹–æ”¾åŠŸèƒ½
        const æ‹–æ”¾å€ = document.getElementById('æ‹–æ”¾å€');
        const æª”æ¡ˆè¼¸å…¥ = document.getElementById('æª”æ¡ˆè¼¸å…¥');
        const é€²åº¦æ¢å®¹å™¨ = document.getElementById('é€²åº¦æ¢å®¹å™¨');
        const é€²åº¦æ¢ = document.getElementById('é€²åº¦æ¢');

        æ‹–æ”¾å€.addEventListener('click', () => æª”æ¡ˆè¼¸å…¥.click());
        
        æª”æ¡ˆè¼¸å…¥.addEventListener('change', (e) => {
            if (e.target.files.length > 0) {
                è™•ç†åœ–ç‰‡ä¸Šå‚³(e.target.files[0]);
            }
        });
        
        æ‹–æ”¾å€.addEventListener('dragover', (e) => {
            e.preventDefault();
            æ‹–æ”¾å€.style.backgroundColor = 'rgba(255, 196, 0, 0.1)';
        });

        æ‹–æ”¾å€.addEventListener('dragleave', () => {
            æ‹–æ”¾å€.style.backgroundColor = 'rgba(255, 196, 0, 0.05)';
        });

        æ‹–æ”¾å€.addEventListener('drop', async (e) => {
            e.preventDefault();
            æ‹–æ”¾å€.style.backgroundColor = 'rgba(255, 196, 0, 0.05)';
            const æª”æ¡ˆ = e.dataTransfer.files[0];
            if (æª”æ¡ˆ) è™•ç†åœ–ç‰‡ä¸Šå‚³(æª”æ¡ˆ);
        });

        // åœ–ç‰‡è™•ç†æµç¨‹
        async function è™•ç†åœ–ç‰‡ä¸Šå‚³(æª”æ¡ˆ) {
            try {
                if (!['image/png', 'image/jpeg'].includes(æª”æ¡ˆ.type)) {
                    throw new Error('åƒ…æ”¯æ´ PNG/JPEG æ ¼å¼');
                }

                // é¡¯ç¤ºé€²åº¦æ¢
                é€²åº¦æ¢å®¹å™¨.style.display = 'block';
                æ›´æ–°é€²åº¦(20);

                // å£“ç¸®åœ–ç‰‡
                const å£“ç¸®å¾Œæª”æ¡ˆ = await å£“ç¸®åœ–ç‰‡(æª”æ¡ˆ, { 
                    maxWidth: 1024,
                    quality: 0.7 
                });

                æ›´æ–°é€²åº¦(50);
                const base64è³‡æ–™ = await è½‰æ›ç‚ºBase64(å£“ç¸®å¾Œæª”æ¡ˆ);

                æ›´æ–°é€²åº¦(70);
                // æ¨¡æ“¬APIå›å‚³è³‡æ–™
                const æ¨¡æ“¬è³‡æ–™ = {
                    è¯çµ¡äºº: [{
                        å§“å: "ç‹å°æ˜",
                        è·ç¨±: "è³‡æ·±å·¥ç¨‹å¸«",
                        å…¬å¸: "å‰µæ–°ç§‘æŠ€æœ‰é™å…¬å¸",
                        é›»è©±: "0912-345-678",
                        ä¿¡ç®±: "xiaoming.wang@example.com",
                        åœ°å€: "å°åŒ—å¸‚ä¿¡ç¾©å€ä¿¡ç¾©è·¯äº”æ®µ7è™Ÿ",
                        ç¶²ç«™: "www.example.com"
                    }]
                };

                æ›´æ–°é€²åº¦(100);
                è¯çµ¡äººåˆ—è¡¨ = [...æ¨¡æ“¬è³‡æ–™.è¯çµ¡äºº, ...è¯çµ¡äººåˆ—è¡¨];
                æ¸²æŸ“è¯çµ¡äºº();

                setTimeout(() => é€²åº¦æ¢å®¹å™¨.style.display = 'none', 500);

            } catch (éŒ¯èª¤) {
                é¡¯ç¤ºéŒ¯èª¤è¨Šæ¯(`è™•ç†å¤±æ•—: ${éŒ¯èª¤.message}`);
                é€²åº¦æ¢å®¹å™¨.style.display = 'none';
            }
        }

        // åŒ¯å‡ºåˆ°é€šè¨ŠéŒ„
        function åŒ¯å‡ºè¯çµ¡äºº(ç´¢å¼•) {
            const è¯çµ¡äºº = è¯çµ¡äººåˆ—è¡¨[ç´¢å¼•];
            const vCardè³‡æ–™ = ç”¢ç”ŸvCard(è¯çµ¡äºº);
            
            const æª”æ¡ˆ = new Blob([vCardè³‡æ–™], { type: 'text/vcard' });
            const æª”æ¡ˆç¶²å€ = URL.createObjectURL(æª”æ¡ˆ);

            if (æ˜¯å¦ç‚ºiOSè£ç½®()) {
                window.location.href = æª”æ¡ˆç¶²å€;
            } else {
                const é€£çµ = document.createElement('a');
                é€£çµ.href = æª”æ¡ˆç¶²å€;
                é€£çµ.download = `${è¯çµ¡äºº.å§“å}.vcf`;
                é€£çµ.click();
                URL.revokeObjectURL(æª”æ¡ˆç¶²å€);
            }
        }

        // ç”¢ç”ŸvCardæ ¼å¼
        function ç”¢ç”ŸvCard(è¯çµ¡äºº) {
            return `BEGIN:VCARD
VERSION:3.0
N:${è¯çµ¡äºº.å§“å};;;
FN:${è¯çµ¡äºº.å§“å}
ORG:${è¯çµ¡äºº.å…¬å¸}
TITLE:${è¯çµ¡äºº.è·ç¨±}
TEL;TYPE=CELL:${è¯çµ¡äºº.é›»è©±}
EMAIL:${è¯çµ¡äºº.ä¿¡ç®±}
ADR:;;${è¯çµ¡äºº.åœ°å€}
URL:${è¯çµ¡äºº.ç¶²ç«™}
END:VCARD`;
        }

        // é›™æ“Šç·¨è¼¯åŠŸèƒ½
        function å•Ÿç”¨ç·¨è¼¯åŠŸèƒ½() {
            document.querySelectorAll('.è³‡æ–™æ¬„ä½').forEach(æ¬„ä½ => {
                æ¬„ä½.ondblclick = function() {
                    const ç´¢å¼• = this.closest('.è¯çµ¡äººé …ç›®').dataset.ç´¢å¼•;
                    const æ¬„ä½åç¨± = this.dataset.æ¬„ä½;
                    const å€¼å®¹å™¨ = this.querySelector('.å€¼å…§å®¹');
                    
                    const è¼¸å…¥æ¡† = å»ºç«‹ç·¨è¼¯è¼¸å…¥æ¡†(è¯çµ¡äººåˆ—è¡¨[ç´¢å¼•][æ¬„ä½åç¨±], æ¬„ä½åç¨±);
                    è¼¸å…¥æ¡†.onblur = () => æ›´æ–°è¯çµ¡äººæ¬„ä½(ç´¢å¼•, æ¬„ä½åç¨±, è¼¸å…¥æ¡†.value);
                    
                    å€¼å®¹å™¨.innerHTML = '';
                    å€¼å®¹å™¨.appendChild(è¼¸å…¥æ¡†);
                    è¼¸å…¥æ¡†.focus();
                };
            });
        }

        // æ¸²æŸ“è¯çµ¡äººåˆ—è¡¨
        function æ¸²æŸ“è¯çµ¡äºº() {
            const å®¹å™¨ = document.getElementById('è¯çµ¡äººæ¸…å–®');
            å®¹å™¨.innerHTML = è¯çµ¡äººåˆ—è¡¨.map((è¯çµ¡äºº, ç´¢å¼•) => `
                <div class="è¯çµ¡äººé …ç›®" data-ç´¢å¼•="${ç´¢å¼•}">
                    <div class="è¯çµ¡äººå…§å®¹">
                        <div class="è³‡æ–™æ¬„ä½" data-æ¬„ä½="å§“å">
                            <div class="åœ–ç¤ºå€">ğŸ‘¤</div>
                            <div class="å€¼å…§å®¹">${è¯çµ¡äºº.å§“å}</div>
                        </div>
                        <div class="è³‡æ–™æ¬„ä½" data-æ¬„ä½="è·ç¨±">
                            <div class="åœ–ç¤ºå€">ğŸ’¼</div>
                            <div class="å€¼å…§å®¹">${è¯çµ¡äºº.è·ç¨±}</div>
                        </div>
                        <div class="è³‡æ–™æ¬„ä½" data-æ¬„ä½="å…¬å¸">
                            <div class="åœ–ç¤ºå€">ğŸ¢</div>
                            <div class="å€¼å…§å®¹">${è¯çµ¡äºº.å…¬å¸}</div>
                        </div>
                        <div class="è³‡æ–™æ¬„ä½" data-æ¬„ä½="é›»è©±">
                            <div class="åœ–ç¤ºå€">ğŸ“±</div>
                            <div class="å€¼å…§å®¹">${è¯çµ¡äºº.é›»è©±}</div>
                        </div>
                        <div class="è³‡æ–™æ¬„ä½" data-æ¬„ä½="ä¿¡ç®±">
                            <div class="åœ–ç¤ºå€">ğŸ“§</div>
                            <div class="å€¼å…§å®¹">${è¯çµ¡äºº.ä¿¡ç®±}</div>
                        </div>
                        <div class="è³‡æ–™æ¬„ä½" data-æ¬„ä½="åœ°å€">
                            <div class="åœ–ç¤ºå€">ğŸ“</div>
                            <div class="å€¼å…§å®¹">${è¯çµ¡äºº.åœ°å€}</div>
                        </div>
                        <div class="è³‡æ–™æ¬„ä½" data-æ¬„ä½="ç¶²ç«™">
                            <div class="åœ–ç¤ºå€">ğŸŒ</div>
                            <div class="å€¼å…§å®¹">${è¯çµ¡äºº.ç¶²ç«™}</div>
                        </div>
                    </div>
                    <button class="ä¸»è¦æŒ‰éˆ•" onclick="åŒ¯å‡ºè¯çµ¡äºº(${ç´¢å¼•})">
                        åŠ å…¥é€šè¨ŠéŒ„
                    </button>
                </div>
            `).join('');

            å•Ÿç”¨ç·¨è¼¯åŠŸèƒ½();
        }

        // å·¥å…·å‡½å¼
        function æ›´æ–°é€²åº¦(ç™¾åˆ†æ¯”) {
            é€²åº¦æ¢.style.width = `${ç™¾åˆ†æ¯”}%`;
        }

        function æ˜¯å¦ç‚ºiOSè£ç½®() {
            return /iPad|iPhone|iPod/.test(navigator.userAgent);
        }

        function å»ºç«‹ç·¨è¼¯è¼¸å…¥æ¡†(å€¼, æ¬„ä½) {
            const è¼¸å…¥æ¡† = document.createElement('input');
            è¼¸å…¥æ¡†.className = 'ç·¨è¼¯è¼¸å…¥æ¡†';
            è¼¸å…¥æ¡†.value = å€¼;
            
            if (æ¬„ä½ === 'é›»è©±') è¼¸å…¥æ¡†.pattern = "[0-9-]{10,}";
            if (æ¬„ä½ === 'ä¿¡ç®±') è¼¸å…¥æ¡†.type = 'email';
            if (æ¬„ä½ === 'ç¶²ç«™') è¼¸å…¥æ¡†.placeholder = "https://";

            return è¼¸å…¥æ¡†;
        }

        function æ›´æ–°è¯çµ¡äººæ¬„ä½(ç´¢å¼•, æ¬„ä½, å€¼) {
            è¯çµ¡äººåˆ—è¡¨[ç´¢å¼•][æ¬„ä½] = å€¼;
            æ¸²æŸ“è¯çµ¡äºº();
        }

        function æ–°å¢è¯çµ¡äºº() {
            è¯çµ¡äººåˆ—è¡¨.unshift({
                å§“å: "æ–°è¯çµ¡äºº",
                è·ç¨±: "",
                å…¬å¸: "",
                é›»è©±: "",
                ä¿¡ç®±: "",
                åœ°å€: "",
                ç¶²ç«™: ""
            });
            æ¸²æŸ“è¯çµ¡äºº();
        }

        async function å£“ç¸®åœ–ç‰‡(æª”æ¡ˆ, é¸é …) {
            return new Promise((resolve) => {
                const åœ–ç‰‡ = new Image();
                åœ–ç‰‡.src = URL.createObjectURL(æª”æ¡ˆ);
                åœ–ç‰‡.onload = () => {
                    const ç•«å¸ƒ = document.createElement('canvas');
                    const ç•«ç­† = ç•«å¸ƒ.getContext('2d');
                    const æ¯”ä¾‹ = Math.min(é¸é ….maxWidth / åœ–ç‰‡.width, 1);
                    ç•«å¸ƒ.width = åœ–ç‰‡.width * æ¯”ä¾‹;
                    ç•«å¸ƒ.height = åœ–ç‰‡.height * æ¯”ä¾‹;
                    ç•«ç­†.drawImage(åœ–ç‰‡, 0, 0, ç•«å¸ƒ.width, ç•«å¸ƒ.height);
                    ç•«å¸ƒ.toBlob(blob => resolve(blob), 'image/jpeg', é¸é ….quality);
                };
            });
        }

        function è½‰æ›ç‚ºBase64(æª”æ¡ˆ) {
            return new Promise((resolve) => {
                const è®€å–å™¨ = new FileReader();
                è®€å–å™¨.onload = e => resolve(e.target.result.split(',')[1]);
                è®€å–å™¨.readAsDataURL(æª”æ¡ˆ);
            });
        }

        function é¡¯ç¤ºéŒ¯èª¤è¨Šæ¯(è¨Šæ¯) {
            const éŒ¯èª¤å€å¡Š = document.createElement('div');
            éŒ¯èª¤å€å¡Š.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                padding: 15px;
                background: var(--éŒ¯èª¤è‰²);
                color: white;
                border-radius: 8px;
                z-index: 1000;
                max-width: 300px;
            `;
            éŒ¯èª¤å€å¡Š.textContent = è¨Šæ¯;
            document.body.appendChild(éŒ¯èª¤å€å¡Š);
            setTimeout(() => éŒ¯èª¤å€å¡Š.remove(), 5000);
        }

        // åˆå§‹åŒ–ç¯„ä¾‹è³‡æ–™
        æ–°å¢è¯çµ¡äºº();
    </script>
</body>
</html>
